postinit:
    - cmds:
        - cmd: docker cp ./config.boot R1:/opt/vyatta/etc/config/config.boot

nodes:
    - name: R1
      image: 2stacks/vyos:1.2.0-rc11  
      docker_run_extra_args: --entrypoint /sbin/init
      interfaces:
        - { name: net0, type: direct, args: R2#net0 }
    - name: R2
      image: slankdev/ubuntu:18.04 
      interfaces:
        - { name: net0, type: direct, args: R1#net0 }

node_configs:
    - name: R1
      cmds:
        - cmd: tcpdump -i net0 -w /tmp/R1-net0.pcap &
        - cmd: sysctl -w net.ipv4.ip_forward=1
        - cmd: sysctl -w net.ipv4.conf.all.rp_filter=0
        - cmd: ip addr add 192.168.12.1/24 dev net0
        - cmd: ip link set net0 address 00:50:56:8e:74:ec
        - cmd: sudo sh -c 'echo 127.0.1.1 $(hostname) >> /etc/hosts'
        # うまくいってない
        - cmd: >-
            sudo -u minion /bin/vbash -c 'configure'
            -c 'load /opt/vyatta/etc/config/config.boot'
            -c 'commit'
    - name: R2
      cmds:
        - cmd: sysctl -w net.ipv4.ip_forward=1
        - cmd: sysctl -w net.ipv4.conf.all.rp_filter=0
        # ppoe client GUI捜査が含まれる
        #- cmd: pppoeconf net0
        #- cmd: pon dsl-provider
        #- cmd: poff dsl-provider    

